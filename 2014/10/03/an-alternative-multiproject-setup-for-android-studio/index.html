<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
  />
  <style>
    #content img {
      max-width: 100%;
    }
    #mc_embed_signup label {
      color: white;
    }
    #mc_embed_signup input.email {
      color: white;
      border-color: white;
    }

    #mc_embed_signup input.button {
      background-color: #ee6e73;
    }
    .rc-scout .rc-scout__link:link {
      color: white;
    }
    .browser-default-uls ul {
      padding-left: 30px;
      margin-top: 10px;
      margin-bottom: 15px;
    }
    .browser-default-uls ul > li {
      list-style-type: disc!important;
    }
    pre {
      overflow: auto;
    }
  </style>
  <title>Philosophical Hacker</title>
</head>
<body><nav>
  <div class="nav-wrapper green">
    <a
      href="/"
      class="brand-logo"
      style="margin-left: 10px;"
      >Philosophical Hacker</a
    >
    <a href="#" data-target="mobile-demo" class="sidenav-trigger"
      ><i class="material-icons">menu</i></a
    >
    <ul class="right hide-on-med-and-down">
      <li><a href="/about/me">About</a></li>
      
      <li><a href="/note">Notes</a></li>
      <li>
        <a
          href="https://www.oreilly.com/library/view/~/9781492048343/?intcmp=il-prog-free-product-na_new_site_rxjava_for_android_app_development"
          >RxJava O'Reilly Ebook</a
        >
      </li>
    </ul>
  </div>
  <ul class="sidenav" id="mobile-demo">
    <li><a href="/about/me">About</a></li>
    
    <li><a href="/note">Notes</a></li>
    <li>
      <a
        href="https://www.oreilly.com/library/view/~/9781492048343/?intcmp=il-prog-free-product-na_new_site_rxjava_for_android_app_development"
        >Rx Java O'Reilly Ebook</a
      >
    </li>
  </ul>
</nav>
<div id="content" class="browser-default-uls">

<div class="row">
  <div class="col s12 m6 offset-m3">
      <section id="main">          
          <h1 id="title">An Alternative Multiproject Setup for Android Studio</h1>
          <p id="date"> Fri Oct 3, 2014 | 5 Minute read </p>
          <div>
                <article id="content">
                   

<p>Google&rsquo;s <a href="http://tools.android.com/tech-docs/new-build-system/user-guide">Gradle Plugin user guide recommends</a> a method for configuring your gradle files to build multiple projects. That method has some shortcomings. In this post, I will briefly explain Google&rsquo;s recommended configuration, note its shortcomings, and  recommend a different way to configure your gradle files to support multi-project setups in Android Studio.</p>

<h2 id="the-google-way">The Google Way</h2>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-9-31-31-pm.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-9-31-31-pm.png?w=620" alt="Screen Shot 2014-10-02 at 9.31.31 PM" /></a></p>

<p>This picture illustrates how Google suggests we handle multi-project setups: our main &ldquo;app&rdquo; module is supposed to depend on library modules that reside within the project directory. When the library modules are within the project directory, telling gradle to build them is easy. Our <code>settings.gradle</code> file looks like this:</p>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-9-34-33-pm.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-9-34-33-pm.png?w=620" alt="Screen Shot 2014-10-02 at 9.34.33 PM" /></a></p>

<p>And our <code>build.gradle</code> looks like this:</p>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-10-38-08-pm.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-10-38-08-pm.png?w=620" alt="Screen Shot 2014-10-02 at 10.38.08 PM" /></a></p>

<p>As you can see, Google&rsquo;s suggested configuration is simple, and its even simpler if you use the Android Studio UI to configure you gradle files for you. In spite of it&rsquo;s simplicity, there are several reasons why we might want to avoid this configuration. I discuss those reasons in the next section.</p>

<h2 id="some-unfortunate-features-of-the-google-way">Some Unfortunate Features of &ldquo;The Google Way&rdquo;</h2>

<p>Both of the unfortunate features of the &ldquo;Google way&rdquo; of handling multi-project setups only arise if your working on several apps that depend on the same libraries. If you only ever work on one app and you know for sure you wont have multiple apps that depend on the same library, feel free to skip the rest of this post and continue blissfully using the simple configuration for multiple projects in Android Studio. If, on the other hand, you are working on several apps that depend on the same libraries, read on.</p>

<p>Suppose you&rsquo;ve got a project structure that looks something like this:</p>

<blockquote>
<p>App1 depends on the <a href="https://github.com/emilsjolander/StickyListHeaders">StickyListHeaders</a> library</p>

<p>App2 depends on the StickyListHeaders library</blockquote></p>
</blockquote>

<p>If you were to follow the Google&rsquo;s user guide in setting up your projects, then you would create two projects, one for App1 and another for App2. The project directories for App1 and App2 would each contain a submodule that has the code from the StickyListHeaders library that each app needs to build successfully.</p>

<p>It doesn&rsquo;t take make to see the unfortunate features of this setup. First off, you have to have copies of a library for every app that depends on it.</p>

<p>If you frequently make changes to that library, you&rsquo;re going to want it to be versioned, and you probably want to have the library in a repository that&rsquo;s separate from your app so that you can checkout the library and reuse it for any app that needs it. Since the library module is a subdirectory within the project, you&rsquo;ll have to use git submodules to achieve this. As <a href="http://codingkilledthecat.wordpress.com/2012/04/28/why-your-company-shouldnt-use-git-submodules/">others have noted</a>, however, git submodules aren&rsquo;t really that great.</p>

<p>So, if you follow the Google way, you&rsquo;re sort of¹ forced to have copies of your libraries for all of your apps that depend on those libraries and if you change those libraries often, then you might have to start using git submodules.²</p>

<h2 id="a-different-way">A Different Way</h2>

<p>It turns out there&rsquo;s a better way to manage multiple projects in Android Studio. The trick is to create separate Android Studio projects for your libraries and to tell gradle that the module for the library that your app depends on is located in the library&rsquo;s project directory. If you wanted to use this method with the project structure I&rsquo;ve described above, you would do the following:</p>

<ol>
<li><p>Create an Android Studio project for the StickyListHeaders library</p></li>

<li><p>Create an Android Studio project for App2</p></li>

<li><p>Create an Android Studio project for App1</p></li>

<li><p>Configure App1 and App2 to build the modules in the StickyListHeaders project.</p></li>
</ol>

<p>The 4th step is the hard part, so that&rsquo;s the only step that I&rsquo;ll describe in detail. You can reference modules that are external to your project&rsquo;s directory by adding a <code>project</code> statement in your <code>settings.gradle</code> file and by setting the <code>projectDir</code> property on the <code>ProjectDescriptor</code> object that&rsquo;s returned by that <code>project</code> statement:</p>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-10-29-45-pm.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-10-29-45-pm.png?w=620" alt="Screen Shot 2014-10-02 at 10.29.45 PM" /></a></p>

<p>If you&rsquo;ve done this correctly, you&rsquo;ll notice that the modules referenced by your project will show up in the project navigator, even if those modules are external to the project directory:</p>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-10-31-30-pm.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2014/10/screen-shot-2014-10-02-at-10-31-30-pm.png?w=620" alt="Screen Shot 2014-10-02 at 10.31.30 PM" /></a></p>

<p>This allows you to work on library code and app code simultaneously. Version control integration also works just fine when you reference modules externally this way. You can commit and push your modifications to the library code just like you can commit and push modifications to your app code.</p>

<p>This way of setting up multiple projects avoids the difficulties that plague Google&rsquo;s recommended configuration. Because we are referencing a module that is outside of the project directory we don&rsquo;t have to make extra copies of the library module for every app that depends on it and we can version our libraries without any sort of git submodule nonsense.</p>

<p>Unfortunately, this other way of setting up multiple projects is very difficult to find. Obviously, its not something you&rsquo;ll figure out from looking at Google&rsquo;s guide, and at this point, there&rsquo;s no way to configure your projects in this way by using the UI of Android Studio. I&rsquo;m hoping that&rsquo;ll change by the time Android Studio hits 1.0</p>

<p>If you&rsquo;ve got any concerns with this setup or if you have a better alternative, I&rsquo;d love to hear it!</p>

<h2 id="notes">Notes:</h2>

<ol>
<li><p>I say &ldquo;sort of&rdquo; because you aren&rsquo;t exactly stuck between the two options I&rsquo;ve discussed here. You could also turn your libraries into maven artifacts and include them into your app that way. This method, however, does not allow you to work on your library code and app code simultaneously unless you run multiple instances of Android Studio. Aint nobody got the memory for that.</p></li>

<li><p>Well, there are alternatives to git submodules that might offer a decent solution here, but why make things so complicated, when you can simply do what I&rsquo;ve suggested in this post.</p></li>
</ol>

                </article>
          </div>
        </section>                
  </div>
  
</div>
<footer class="page-footer green text-white">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
            
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<div id="mc_embed_signup">
<form action="//appspot.us11.list-manage.com/subscribe/post?u=9612e1a3261cb5689813bf38b&amp;id=0c5f737d6c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Get Email Updates</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9612e1a3261cb5689813bf38b_0c5f737d6c" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>


            <div class="rc-scout" style="text-align: center;"></div>    
        </div>
        <aside id="meta">            
            <div>
                
                <div>                  
                  <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/2014/05/27/some-responses-to-your-comments-on-why-paul-graham-is-sort-of-wrong-about-philosophy/">Previous: A response to Your Comments on &#34;Why Paul Graham is (sort of) wrong about philosophy&#34;</a>
                </div>
                
                
                <div>                  
                  <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/2015/01/18/build-apps-smarter-with-archiva-and-gradle/">Next: Build Apps Smarter With Archiva and Gradle</a>
                </div>
                
            </div>
        </aside>  
        <div class="col l4 offset-l2 s12">
          <h5 class="white-text">Tags</h5>
          <ul>              
              
              <ul id="tags">
                
                  <li> <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/tags/android">android</a> </li>
                
                  <li> <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/tags/android-studio">android studio</a> </li>
                
                  <li> <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/tags/multiproject-setups">multiproject setups</a> </li>
                
              </ul>
                          
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      © 2019 Matt Dupree
      </div>
    </div>    
  </footer>        


        </div><script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var elems = document.querySelectorAll(".sidenav");
    var instances = M.Sidenav.init(elems, {});
  });
</script>
<script async defer src="https://www.recurse-scout.com/loader.js?t=b7a91d718a76fe21289fbe7d51a58f19"></script>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-63544399-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
