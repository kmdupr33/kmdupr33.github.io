<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8" />
  <meta
    name="description"
    content=""
  />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
  />
  <link href="/css/all.min.css" rel="stylesheet" />
  <style>
    #content {
      font-size: 18px;
      line-height: 1.7;
    }
    #content img {
      max-width: 100%;
    }
    #mc_embed_signup label {
      color: white;
    }
    #mc_embed_signup input.email {
      color: white;
      border-color: white;
    }

    #mc_embed_signup input.button {
      background-color: #ee6e73;
    }
    .rc-scout .rc-scout__link:link {
      color: white;
    }
    .browser-default-uls ul {
      padding-left: 30px;
      margin-top: 10px;
      margin-bottom: 15px;
    }
    .browser-default-uls ul > li {
      list-style-type: disc !important;
    }
    pre {
      overflow: auto;
      padding: 15px;
    }
  </style>
  <title> Android Testing Calisthenics: Domain Objects | Philosophical Hacker </title>
  
  
</head>
<body><nav>
  <div class="nav-wrapper green">
    <a
      href="/"
      class="brand-logo"
      style="margin-left: 10px;"
      >Philosophical Hacker</a
    >
    <a href="#" data-target="mobile-demo" class="sidenav-trigger"
      ><i class="material-icons">menu</i></a
    >
    <ul class="right hide-on-med-and-down">      
      <li><a href="/about/me">About</a></li>
      <li><a href="/talk">Talks</a></li>
      <li><a href="/note">Notes</a></li>
      <li>
        <a
          href="https://www.oreilly.com/library/view/~/9781492048343/?intcmp=il-prog-free-product-na_new_site_rxjava_for_android_app_development"
          >RxJava O'Reilly Ebook</a
        >
      </li>
      <li>
          <a href="https://twitter.com/philosohacker"
            ><i class="fab fa-twitter"></i
          ></a>
        </li>
        <li>
          <a href="https://www.linkedin.com/in/k-matthew-dupree-44672178/"
            ><i class="fab fa-linkedin-in"></i
          ></a>
        </li>
    </ul>
  </div>
  <ul class="sidenav" id="mobile-demo">    
    <li><a href="/about/me">About</a></li>
    <li><a href="/talk">Talks</a></li>
    <li><a href="/note">Notes</a></li>
    <li>
      <a
        href="https://www.oreilly.com/library/view/~/9781492048343/?intcmp=il-prog-free-product-na_new_site_rxjava_for_android_app_development"
        >Rx Java O'Reilly Ebook</a
      >
    </li>
    <li>
        <a href="https://twitter.com/philosohacker"
          ><i class="fab fa-twitter"></i
        ></a>
      </li>
      <li>
        <a href="https://www.linkedin.com/in/k-matthew-dupree-44672178/"
          ><i class="fab fa-linkedin-in"></i
        ></a>
      </li>
  </ul>
</nav>
<div id="content" class="browser-default-uls">

    <img style="filter: brightness(.4); width: 100%;" src="/images/marathon.jpg"/>

<div class="row">
  <div class="col s12 m6 offset-m3">
      <section id="main">          
          <h1 id="title">Android Testing Calisthenics: Domain Objects</h1>
          
          <p id="date" class="grey-text text-darken-1i"> Fri Apr 14, 2017 | 6 Minute read </p>
          <div>
                <article id="content">
                   

<p>Imagine that you&rsquo;ve never run a single mile in your life. You know that exercising is good for your health, so you decide that you&rsquo;re going to take up running. Strangely, however, you also decide that you&rsquo;re going to begin your journey towards physical fitness by running a marathon tomorrow.</p>

<p>That&rsquo;s obviously a bad idea.</p>

<p>Less obviously, deciding to go from no experience with testing to writing tests for an already existing Android app is also a bad idea. Adding test coverage to an already existing Android application is a marathon-level testing project. It&rsquo;d be more sensible to start with something smaller and work your way up.</p>

<p>This post invites you to embrace this sensible idea. It&rsquo;s a series of exercises designed slowly introduce you to the challenge of testing Android applications. Before we do that though, I want to say a little about why I think Android testing is one of the hardest kinds of testing you can do.</p>

<h3 id="android-a-marathon-level-testing-project">Android: A Marathon-Level Testing Project</h3>

<p>I&rsquo;ve been reading through Gerard Meszaros&rsquo; <em>xUnit Testing Patterns</em>. The other day I stumbled upon this passage:</p>

<blockquote>
<p>Some kinds of tests are harder to write than others. This difficulty arises partly because the techniques are more involved and partly because they are less well known&hellip;The following common kinds of tests are listed in approximate order of difficulty, from easiest to most difficult.</p>

<ol>
<li>Simple entity objects</li>
<li>Stateless service objects</li>
<li>Stateful service objects</li>
<li>User Interface, database, and multi-threaded logic</li>
<li>Object-oriented legacy software (software built without tests)</li>
<li>Non-object-oriented legacy software<sup>1</sup></li>
</ol>
</blockquote>

<p>I&rsquo;ve talked <a href="/2015/04/17/why-android-unit-testing-is-so-hard-pt-1/">a</a> <a href="/post/why-android-testing-is-so-hard-historical-edition/">lot</a> about why Android unit testing is so hard, but this passage struck me. As it read it, it occurred to me that testing Android code is combination of the hardest thing on that list with the 3rd hardest thing on that list. Android apps don&rsquo;t tend to be object oriented and they involve a lot of user interface, database, and multi-threaded code.</p>

<p>So, those who attempt to add tests to already existing Android apps are really doing something difficult. I&rsquo;m not the only one saying that. Meszaros suggests the same thing (by implication) in the above passage.</p>

<h3 id="calisthenics">Calisthenics</h3>

<p>Instead of starting with the hardest possible target to test, let&rsquo;s work our way up. <a href="https://github.com/kmdupr33/TestingCalisthenics">This github project</a> has some exercises to get you ready. If you want, you can checkout the project and switch between the challenge and solution branches as you work through them. Throughout the remainder of the post, I&rsquo;ll present a testing challenge and the solution to that challenge. If you really want to ready for testing Android apps, I&rsquo;d suggest you try to work through the challenge and check your solution with the ones that I suggest.</p>

<h4 id="domain-object">Domain Object</h4>

<p>The easiest thing to test, according to Meszaros, is a simple domain object. We don&rsquo;t typically deal with domain objects in Android development since Android apps tend not to be object oriented, but this is still a helpful starting point for learning testing.</p>

<p>To come up with our challenge, we can think back to the business rule we discovered while <a href="/post/what-unit-tests-are-trying-to-tell-us-about-activities-pt1/">we were looking at the google I/O conference app a couple weeks back</a>: A user cannot remove the keynote session from her schedule. Instead of encoding this business rule in the UI, suppose we had an actual domain object that enforced it:</p>

<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#fff;font-weight:bold">class</span> Schedule {
    <span style="color:#fff;font-weight:bold">void</span> remove(Session session) {
        <span style="color:#fff;font-weight:bold">if</span> (session.<span style="color:#007f7f">isKeynote</span>()) {
            <span style="color:#fff;font-weight:bold">throw</span> <span style="color:#fff;font-weight:bold">new</span> UnsupportedOperationException();
        }
        sessions.<span style="color:#007f7f">remove</span>(session);
    }
}</code></pre></div>

<p>This is a simple, not-so-scary piece of code. Because <a href="/post/what-should-we-unit-test/">the code doesn&rsquo;t scare us</a>, we might not write a test for it in real life, but we&rsquo;re just getting our feet wet with testing, so let&rsquo;s give it a go. Here&rsquo;s the stubs of the test methods you&rsquo;ll need to fill in:</p>

<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#fff;font-weight:bold">public</span> class ScheduleTest {
  @Test <span style="color:#fff;font-weight:bold">public</span> void removesNonKeynoteSession() <span style="color:#fff;font-weight:bold">throws</span> Exception {

  }

  @Test <span style="color:#fff;font-weight:bold">public</span> void throwsOnRemoveKeyNote() <span style="color:#fff;font-weight:bold">throws</span> Exception {
  }
}</code></pre></div>

<p>In the first method, you want to check that <code>Schedule</code> actually removes non-keynote sessions. In the second method, you want to check that <code>Schedule</code> throws an exception if you try to remove a keynote session. Give it a go! When you scroll down, you&rsquo;ll see how I&rsquo;ve filled in these methods.</p>

<hr />

<p>Here&rsquo;s how I wrote <code>removesNonKeynoteSession</code>:</p>

<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Test <span style="color:#fff;font-weight:bold">public</span> void removesNonKeynoteSession() <span style="color:#fff;font-weight:bold">throws</span> Exception {
    Schedule schedule = <span style="color:#fff;font-weight:bold">new</span> Schedule();
    <span style="color:#fff;font-weight:bold">final</span> Session session = <span style="color:#fff;font-weight:bold">new</span> Session(<span style="color:#fff;font-weight:bold">false</span>);
    schedule.<span style="color:#007f7f">add</span>(session);
    schedule.<span style="color:#007f7f">remove</span>(session);
    assertFalse(schedule.<span style="color:#007f7f">get</span>().<span style="color:#007f7f">contains</span>(session));
}</code></pre></div>

<p>And here&rsquo;s how I wrote <code>throwsOnRemoveKeynote</code>:</p>

<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Test(expected = UnsupportedOperationException.<span style="color:#007f7f">class</span>) <span style="color:#fff;font-weight:bold">public</span> void throwsOnRemoveKeyNote() <span style="color:#fff;font-weight:bold">throws</span> Exception {
    Schedule schedule = <span style="color:#fff;font-weight:bold">new</span> Schedule();
    <span style="color:#fff;font-weight:bold">final</span> Session session = <span style="color:#fff;font-weight:bold">new</span> Session(<span style="color:#fff;font-weight:bold">true</span>);
    schedule.<span style="color:#007f7f">add</span>(session);
    schedule.<span style="color:#007f7f">remove</span>(session);
}</code></pre></div>

<p>Already we&rsquo;re seeing a pattern in these two tests. This pattern turns out to be core to testing. Each test method consists of three stages: arrange, act, assert. In the arrange stage, we get our domain object into the appropriate state for our test. In the case of <code>throwsOnRemoveKeyNote</code>, the arrange steps consist of these highlighted lines:</p>

<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Test <span style="color:#fff;font-weight:bold">public</span> void removesNonKeynoteSession() <span style="color:#fff;font-weight:bold">throws</span> Exception {
<span style="display:block;width:100%;background-color:#191919">    Schedule schedule = <span style="color:#fff;font-weight:bold">new</span> Schedule();
</span><span style="display:block;width:100%;background-color:#191919">    <span style="color:#fff;font-weight:bold">final</span> Session session = <span style="color:#fff;font-weight:bold">new</span> Session(<span style="color:#fff;font-weight:bold">false</span>);
</span><span style="display:block;width:100%;background-color:#191919">    schedule.<span style="color:#007f7f">add</span>(session);
</span>    schedule.<span style="color:#007f7f">remove</span>(session);
    assertFalse(schedule.<span style="color:#007f7f">get</span>().<span style="color:#007f7f">contains</span>(session));
}</code></pre></div>

<p>Remember: we&rsquo;re trying to test that the <code>Schedule</code> allow us to remove a non-keynote session. To test that, we need a <code>Schedule</code> that has a non-keynote <code>Session</code> added to it, and that&rsquo;s precisely what we&rsquo;re doing in these three lines.</p>

<p>The second stage in our test is the act stage. This is when we actually exercise the code we&rsquo;re trying to test. In this case, we&rsquo;re testing that <code>schedule.remove</code> works correctly, so we call that method.</p>

<p>The last stage is &ldquo;assert,&rdquo; where we&rsquo;re actually making sure that, given the conditions we setup in the arrange stage and given that the target code has actually executed in the act stage, that target code has done what we wanted it to do. In this case, we expect that the <code>Session</code> removed should no longer show up in the list of sessions on a certain schedule. This is what we&rsquo;re doing by calling <code>assertFalse(schedule.get().contains(session))</code>.</p>

<p>To double check your understanding of the three stages of a test, why not try to identify which lines correspond to which stage in <code>throwsOnRemoveKeyNote</code>. Again, scroll down when you&rsquo;re ready.</p>

<hr />

<p>Arrange:</p>

<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">@Test(expected = UnsupportedOperationException.<span style="color:#007f7f">class</span>) <span style="color:#fff;font-weight:bold">public</span> void throwsOnRemoveKeyNote() <span style="color:#fff;font-weight:bold">throws</span> Exception {
<span style="display:block;width:100%;background-color:#191919">    Schedule schedule = <span style="color:#fff;font-weight:bold">new</span> Schedule();
</span><span style="display:block;width:100%;background-color:#191919">    <span style="color:#fff;font-weight:bold">final</span> Session session = <span style="color:#fff;font-weight:bold">new</span> Session(<span style="color:#fff;font-weight:bold">true</span>);
</span><span style="display:block;width:100%;background-color:#191919">    schedule.<span style="color:#007f7f">add</span>(session);
</span>    schedule.<span style="color:#007f7f">remove</span>(session);
}</code></pre></div>

<p>Act is when we call <code>schedule.remove()</code></p>

<p>Assert:</p>

<div class="highlight"><pre style="color:#e5e5e5;background-color:#000;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="display:block;width:100%;background-color:#191919">@Test(expected = UnsupportedOperationException.<span style="color:#007f7f">class</span>) <span style="color:#fff;font-weight:bold">public</span> void throwsOnRemoveKeyNote() <span style="color:#fff;font-weight:bold">throws</span> Exception {
</span>    Schedule schedule = <span style="color:#fff;font-weight:bold">new</span> Schedule();
    <span style="color:#fff;font-weight:bold">final</span> Session session = <span style="color:#fff;font-weight:bold">new</span> Session(<span style="color:#fff;font-weight:bold">true</span>);
    schedule.<span style="color:#007f7f">add</span>(session);
    schedule.<span style="color:#007f7f">remove</span>(session);
}</code></pre></div>

<p>(When we pass <code>UnsupportedOperationException.class</code> as the value for <code>expected</code>)</p>

<h3 id="conclusion">Conclusion</h3>

<p>Hopefully that wasn&rsquo;t too difficult. Hopefully that was a helpful exercise. Next time, we&rsquo;ll make things a bit more difficult. Until then, feedback and questions are welcome!</p>

<h3 id="notes">Notes:</h3>

<ol>
<li>Gerard Meszaros, <em>xUnit Test Patterns</em>, 247-248.</li>
</ol>

                </article>
          </div>
        </section>                
  </div>
  
</div>
<footer class="page-footer green text-white">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
            
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<div id="mc_embed_signup">
<form action="//appspot.us11.list-manage.com/subscribe/post?u=9612e1a3261cb5689813bf38b&amp;id=0c5f737d6c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Get Email Updates</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9612e1a3261cb5689813bf38b_0c5f737d6c" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>


            <div class="rc-scout" style="text-align: center;"></div>    
        </div>
        <aside id="meta">            
            <div>
                
                <div>                  
                  <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/post/test-driving-away-coupling-in-activities/">Previous: Test Driving away Coupling in Activities</a>
                </div>
                
                
                <div>                  
                  <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/post/setting-up-a-jenkins-pipeline-for-android-testing/">Next: Setting up a Jenkins Pipeline for Android Testing</a>
                </div>
                
            </div>
        </aside>  
        <div class="col l4 offset-l2 s12">
          <h5 class="white-text">Tags</h5>
          <ul>              
              
              <ul id="tags">
                
                  <li> <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/tags/android">android</a> </li>
                
                  <li> <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/tags/testing">testing</a> </li>
                
              </ul>
                          
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      Â© 2019 Matt Dupree
      </div>
    </div>    
  </footer>        


        </div><script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var elems = document.querySelectorAll(".sidenav");
    var instances = M.Sidenav.init(elems, {});
  });
</script>
<script async defer src="https://www.recurse-scout.com/loader.js?t=b7a91d718a76fe21289fbe7d51a58f19"></script>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-63544399-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
