<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8" />
  <meta
    name="description"
    content=""
  />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
  />
  <link href="/css/all.min.css" rel="stylesheet" />
  <style>
    #content {
      font-size: 18px;
      line-height: 1.7;
    }
    #content img {
      max-width: 100%;
      display: block;
      margin: 0 auto;
    }
    #mc_embed_signup label {
      color: white;
    }
    #mc_embed_signup input.email {
      color: white;
      border-color: white;
    }

    #mc_embed_signup input.button {
      background-color: #ee6e73;
    }
    .rc-scout .rc-scout__link:link {
      color: white;
    }
    .browser-default-uls ul {
      padding-left: 30px;
      margin-top: 10px;
      margin-bottom: 15px;
    }
    .browser-default-uls ul > li {
      list-style-type: disc !important;
    }
    pre {
      overflow: auto;
      padding: 15px;
    }
  </style>
  <title> A Neural Network in Kotlin (Pt. 1) | Philosophical Hacker </title>
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.css" integrity="sha384-IfEbO0yhy2n4/+OZc9LUjnq7UDEUifPgfe34YcKod1rOJyX0JNBJ4/6XKpclZtj3" crossorigin="anonymous">
    <script defer src="https://cdn.jsdelivr.net/npm/katex@0.11.0/dist/katex.js" integrity="sha384-07m3BXnpyYn3KtPIt7XjRYaNz2mc2OKdnUmRGNQxx7cMbT78d1JTy71cyEiCBQHr" crossorigin="anonymous"></script>
  
  
</head>
<body><nav>
  <div class="nav-wrapper green">
    <a
      href="/"
      class="brand-logo"
      style="margin-left: 10px;"
      >Philosophical Hacker</a
    >
    <a href="#" data-target="mobile-demo" class="sidenav-trigger"
      ><i class="material-icons">menu</i></a
    >
    <ul class="right hide-on-med-and-down">      
      <li><a href="/about/me">About</a></li>
      <li><a href="/talk">Talks</a></li>
      <li><a href="/note">Notes</a></li>
      <li>
        <a
          href="https://www.oreilly.com/library/view/~/9781492048343/?intcmp=il-prog-free-product-na_new_site_rxjava_for_android_app_development"
          >RxJava O'Reilly Ebook</a
        >
      </li>
      <li>
          <a href="https://twitter.com/philosohacker"
            ><i class="fab fa-twitter"></i
          ></a>
        </li>
        <li>
          <a href="https://www.linkedin.com/in/k-matthew-dupree-44672178/"
            ><i class="fab fa-linkedin-in"></i
          ></a>
        </li>
    </ul>
  </div>
  <ul class="sidenav" id="mobile-demo">    
    <li><a href="/about/me">About</a></li>
    <li><a href="/talk">Talks</a></li>
    <li><a href="/note">Notes</a></li>
    <li>
      <a
        href="https://www.oreilly.com/library/view/~/9781492048343/?intcmp=il-prog-free-product-na_new_site_rxjava_for_android_app_development"
        >Rx Java O'Reilly Ebook</a
      >
    </li>
    <li>
        <a href="https://twitter.com/philosohacker"
          ><i class="fab fa-twitter"></i
        ></a>
      </li>
      <li>
        <a href="https://www.linkedin.com/in/k-matthew-dupree-44672178/"
          ><i class="fab fa-linkedin-in"></i
        ></a>
      </li>
  </ul>
</nav>
<div id="content" class="browser-default-uls">

<div class="row">
  <div class="col s12 m8 l6 offset-m2 offset-l3">
      <section id="main">          
          <h1 id="title">A Neural Network in Kotlin (Pt. 1)</h1>
          <h5 class="grey-text text-darken-1i">(The &#34;Hello World&#34; of Deep Learning)</h5>
          <p id="date" class="grey-text text-darken-1i"> Sun Sep 15, 2019 | 4 Minute read </p>
          <div>
                <article id="content">
                   

<p>!!!! <em>This is just a draft of a post that I&rsquo;ve published for review</em> !!!</p>

<hr />

<h2 id="introduction">Introduction</h2>

<p>Neural networks can be a good strategy for solving machine learning problems. Just like I did with gradient descent and linear regression, I want to try to give you an idea of how they work and how you&rsquo;d implement one from scratch<sup class="footnote-ref" id="fnref:1"><a href="#fn:1">1</a></sup> in Kotlin. I&rsquo;ll be using the mnist handwritten digit data set.</p>

<p>Same disclaimer as last time: everything I cover here is covered in <a href="https://www.coursera.org/learn/machine-learning">Andrew Ng&rsquo;s course</a> and if you&rsquo;re looking for a rock solid explanation and implementation, look there instead of here.</p>

<h2 id="our-toy-problem">Our Toy Problem</h2>

<p>The task we&rsquo;re interested in will be classifying hand-written digits. There&rsquo;s a standard data-set that everyone likes to use for this sort of thing. In fact, <a href="https://www.tensorflow.org/beta/tutorials/keras/basic_classification">tensorflow&rsquo;s basic tutorial uses this same problem</a>, so if you&rsquo;ve ever worked through that tutorial, you&rsquo;re about to see the magic behind that. The data-set is just a bunch of 28 by 28 pixel images that look like this:</p>

<p><img src="./MnistExamples.png" alt="image of &quot;1&quot; written by h and" /></p>

<h2 id="our-neural-network">Our neural network</h2>

<p>We&rsquo;re going to work with a neural network with 3 layers: an input layer, a hidden layer, and an output layer.<sup class="footnote-ref" id="fnref:2"><a href="#fn:2">2</a></sup> The input layer just consists of nodes for every pixel in an image. The hidden layer will have 25 nodes, and the final layer will spit out a classification of the image:</p>

<p><img src="./network.png" alt="network diagram" /></p>

<p>All these nodes or &ldquo;neurons&rdquo; (represented as circles) are doing is taking in an input (represented as lines pointing to the circles) and doing a computation whose result is passed to the next layer.</p>

<p>How those values are passed to the next layer involves some basic linear algebra. There&rsquo;s a matrix of weights for each non-input layer, so in our case, we have 2 theta matrices:</p>



<div id="thetas"></div>
<script>
  addEventListener("DOMContentLoaded", () => {
    katex.render("\\Theta^{1} \\Theta^{2}", document.getElementById("thetas"), {
      throwOnError: false,
      displayMode: true
    });
  });
</script>


<p>We can represent the nodes in the second layer of the network as a vector we&rsquo;ll call <code>a2</code>. The values for each node in the second layer are equal to this:</p>



<div id="a2"></div>
<script>
  addEventListener("DOMContentLoaded", () => {
    katex.render("a^{2} = sigmoid(\\Theta^{1}\\times a^{1})", document.getElementById("a2"), {
      throwOnError: false,
      displayMode: true
    });
  });
</script>


<p>where <code>sigmoid()</code> just applies the following function to each element in the matrix:</p>



<div id="sigmoid"></div>
<script>
  addEventListener("DOMContentLoaded", () => {
    katex.render("1 \/ 1 \x2b e^{-element}", document.getElementById("sigmoid"), {
      throwOnError: false,
      displayMode: true
    });
  });
</script>


<p>Calculating <code>a3</code> involves a similar formula:</p>



<div id="a3"></div>
<script>
  addEventListener("DOMContentLoaded", () => {
    katex.render("a^{3} = sigmoid(\\Theta^{2} \\times a^{2})", document.getElementById("a3"), {
      throwOnError: false,
      displayMode: true
    });
  });
</script>


<p><code>a3</code> is a vector that represents the output layer and it gives us the predictions we&rsquo;re looking for: each element in the layer is the probability that the digit fed into the neural network is the number at that index in the vector. For example, the probability at the 2nd index in this vector, is the probability that the digit passed into the neural network is a <code>1</code>.</p>

<p>Implementing matrices and matrix operations in Kotlin is actually not too bad with features like operator overloads. Here&rsquo;s a nice snippet that shows how easy it is to implement matrix multiplication with a class that just wraps an array of arrays:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin"><span style="color:#66d9ef">operator</span> <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">times</span>(otherMatrix: Matrix): Matrix {
    <span style="color:#66d9ef">if</span> (numColumns() != otherMatrix.numRows())
        <span style="color:#66d9ef">throw</span> IllegalArgumentException(
            <span style="color:#e6db74">&#34;Cannot multiply ${raw.size} x ${raw[0].size} matrix&#34;</span> +
                    <span style="color:#e6db74">&#34; ${otherMatrix.numRows()} x ${otherMatrix.numColumns()} matrix&#34;</span>
        )
    <span style="color:#66d9ef">fun</span> <span style="color:#a6e22e">compute</span>(rowIndex: Int, columnIndex: Int): Float {
        <span style="color:#66d9ef">val</span> row = raw[rowIndex]
        <span style="color:#66d9ef">val</span> column = otherMatrix.column(columnIndex)
        <span style="color:#66d9ef">return</span> row.zip(column) { a, b -&gt; a * b }.sum()
    }
    <span style="color:#66d9ef">return</span> Matrix(Array(raw.size) { rowIndex -&gt;
        Array(otherMatrix.numColumns()) { columnIndex -&gt;
            compute(rowIndex, columnIndex)
        }
    })

}</code></pre></div>

<p>With this code, we can multiply matrices just like we multiply numbers:</p>

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kotlin" data-lang="kotlin">theta1 * a1</code></pre></div>

<h2 id="notes">Notes</h2>
<div class="footnotes">

<hr />

<ol>
<li id="fn:1">In practice, its likely better to use a machine learning library like tensorflow to build a neural network, but I&rsquo;m trying to solidify my understand of how neural networks work, so I&rsquo;m building it myself.
 <a class="footnote-return" href="#fnref:1"><sup>[return]</sup></a></li>
<li id="fn:2">This is the same neural network architecture thats used to solve this problem in the Coursera course.
 <a class="footnote-return" href="#fnref:2"><sup>[return]</sup></a></li>
</ol>
</div>

                </article>
          </div>
        </section>                
  </div>
  
</div>
<footer class="page-footer green text-white">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
            
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<div id="mc_embed_signup">
<form action="//appspot.us11.list-manage.com/subscribe/post?u=9612e1a3261cb5689813bf38b&amp;id=0c5f737d6c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Get Email Updates</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9612e1a3261cb5689813bf38b_0c5f737d6c" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>


            <div class="rc-scout" style="text-align: center;"></div>    
        </div>
        <aside id="meta">            
            <div>
                
                <div>                  
                  <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/post/gradient-descent-for-kotlin-programmers/">Previous: An Intro to Gradient Descent for Kotlin Programmers</a>
                </div>
                
                
            </div>
        </aside>  
        <div class="col l4 offset-l2 s12">
          <h5 class="white-text">Tags</h5>
          <ul>              
              
              <ul id="tags">
                
                  <li> <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/tags/kotlin">kotlin</a> </li>
                
                  <li> <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/tags/programming">programming</a> </li>
                
                  <li> <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/tags/machine-learning">machine learning</a> </li>
                
              </ul>
                          
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      © 2019 Matt Dupree
      </div>
    </div>    
  </footer>        


        </div><script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var elems = document.querySelectorAll(".sidenav");
    var instances = M.Sidenav.init(elems, {});
  });
</script>
<script async defer src="https://www.recurse-scout.com/loader.js?t=b7a91d718a76fe21289fbe7d51a58f19"></script>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-63544399-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
