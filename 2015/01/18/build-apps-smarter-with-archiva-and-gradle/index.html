<!DOCTYPE html>
<html><head>
  <meta charset="UTF-8" />
  <meta
    name="description"
    content=""
  />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta http-equiv="X-UA-Compatible" content="ie=edge" />
  <link
    href="https://fonts.googleapis.com/icon?family=Material+Icons"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css"
  />
  <link href="/css/all.min.css" rel="stylesheet" />
  <style>
    #content {
      font-size: 18px;
      line-height: 1.7;
    }
    #content img {
      max-width: 100%;
      display: block;
      margin: 0 auto;
    }
    #mc_embed_signup label {
      color: white;
    }
    #mc_embed_signup input.email {
      color: white;
      border-color: white;
    }

    #mc_embed_signup input.button {
      background-color: #ee6e73;
    }
    .rc-scout .rc-scout__link:link {
      color: white;
    }
    .browser-default-uls ul {
      padding-left: 30px;
      margin-top: 10px;
      margin-bottom: 15px;
    }
    .browser-default-uls ul > li {
      list-style-type: disc !important;
    }
    pre {
      overflow: auto;
      padding: 15px;
    }
  </style>
  <title> Build Apps Smarter With Archiva and Gradle | Philosophical Hacker </title>
  
  
</head>
<body><nav>
  <div class="nav-wrapper green">
    <a
      href="/"
      class="brand-logo"
      style="margin-left: 10px;"
      >Philosophical Hacker</a
    >
    <a href="#" data-target="mobile-demo" class="sidenav-trigger"
      ><i class="material-icons">menu</i></a
    >
    <ul class="right hide-on-med-and-down">      
      <li><a href="/about/me">About</a></li>
      <li><a href="/talk">Talks</a></li>
      <li><a href="/note">Notes</a></li>
      <li>
        <a
          href="https://www.oreilly.com/library/view/~/9781492048343/?intcmp=il-prog-free-product-na_new_site_rxjava_for_android_app_development"
          >RxJava O'Reilly Ebook</a
        >
      </li>
      <li>
          <a href="https://twitter.com/philosohacker"
            ><i class="fab fa-twitter"></i
          ></a>
        </li>
        <li>
          <a href="https://www.linkedin.com/in/k-matthew-dupree-44672178/"
            ><i class="fab fa-linkedin-in"></i
          ></a>
        </li>
    </ul>
  </div>
  <ul class="sidenav" id="mobile-demo">    
    <li><a href="/about/me">About</a></li>
    <li><a href="/talk">Talks</a></li>
    <li><a href="/note">Notes</a></li>
    <li>
      <a
        href="https://www.oreilly.com/library/view/~/9781492048343/?intcmp=il-prog-free-product-na_new_site_rxjava_for_android_app_development"
        >Rx Java O'Reilly Ebook</a
      >
    </li>
    <li>
        <a href="https://twitter.com/philosohacker"
          ><i class="fab fa-twitter"></i
        ></a>
      </li>
      <li>
        <a href="https://www.linkedin.com/in/k-matthew-dupree-44672178/"
          ><i class="fab fa-linkedin-in"></i
        ></a>
      </li>
  </ul>
</nav>
<div id="content" class="browser-default-uls">

<div class="row">
  <div class="col s12 m8 l6 offset-m2 offset-l3">
      <section id="main">          
          <h1 id="title">Build Apps Smarter With Archiva and Gradle</h1>
          
          <p id="date" class="grey-text text-darken-1i"> Sun Jan 18, 2015 | 4 Minute read </p>
          <div>
                <article id="content">
                   

<p>Dependency management in both Eclipse and Android Studio can be a serious pain. Now that we have gradle, there’s a better way to build android apps: we can configure our library projects to publish maven artifacts to a maven repository and we can configure our app projects to consume those artifacts. Once projects are setup to produce and consume maven artifacts, building an app with many dependencies becomes much more manageable.</p>

<p>In this post, I will say a little bit about why dependency management can be painful and I will explain how to use archiva and gradle to make dependency management a breeze.</p>

<h2 id="the-dumb-way">The Dumb Way</h2>

<p>With Eclipse, the workflow for creating a multi-project setup went something like this:</p>

<ol>
<li><p>Create an app project.</p></li>

<li><p>Create library projects.</p></li>

<li><p>Add library projects as a dependencies for the app project.</p></li>

<li><p>Push all projects to version control</p></li>
</ol>

<p>This isn’t terrible, but whenever someone else wants to build your app, they need to:</p>

<ol>
<li><p>Checkout the app project</p></li>

<li><p>Import that project into Eclipse</p></li>

<li><p>Checkout library projects</p></li>

<li><p>Import those projects into Eclipse</p></li>

<li><p>Add those library projects as dependencies for the app project.</p></li>
</ol>

<p>If you’re building an app that uses 3+ libraries, this can be pretty painful.</p>

<p>Even with Android Studio, it can be challenging to create a workable multi-project setup. <a href="http://philosophicalhacker.com/2014/10/02/an-alternative-multiproject-setup-for-android-studio/">I’ve already discussed those challenges</a>, so I won’t do so again here.</p>

<h2 id="the-smart-way">The Smart Way</h2>

<p>The first thing you need to ‘build apps smarter’ is a maven repository. I’ll explain how to setup <a href="http://archiva.apache.org/index.cgi">Archiva</a>, but you could easily use other maven repo solutions.</p>

<p>Start by <a href="http://archiva.apache.org/download.cgi">downloading archiva</a>. Next, start archiva by running:</p>

<p><code>/bin/archiva console</code></p>

<p>After archiva finishes loading (which could be a while), you can load up the interface by pointing your browser to localhost:8080.</p>

<p>At this point, you need to create 2 users. First, create an admin user by clicking the ‘Create admin’ button at the top right corner of the screen. After you create an admin user, you should be automatically logged in.</p>

<p>At this point, you can click the ‘Manage’ menu item in the side menu (its the first menu item underneath the section heading with the title ‘Users’). From here, its pretty easy to create a user. This is the user that gradle will use to publish artifacts to the repo, so remember the username and password you enter here for later.</p>

<p>Once you create the user, you’ll need to edit the user so that it can manage your repositories. To do this, click the pencil-looking button next to the user you’ve just created. Next select the ‘Edit Roles’ tab. Finally, check the ‘Repository Manager’ box next to the ‘internal’ repository and click update.</p>

<p>That’s the bare minimum you need for your archiva maven repo setup. Now you just need to configure your projects to publish artifacts to and consume artifacts from the maven repo.</p>

<p>Let’s start with configuring our library projects to publish .aar files as consumable maven artifacts. Open up the build.gradle file for the module that contains your library code. First, apply the maven plugin to your module. Then add the code that will upload the build output of your library project to the maven repo:</p>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-18-at-8-14-34-am.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-18-at-8-14-34-am.png?w=660" alt="Screen Shot 2015-01-18 at 8.14.34 AM" /></a></p>

<p>In order to upload your artifact to archiva, you simply run the uploadArchives task. That can been done within Android Studio with the following steps:</p>

<ol>
<li><p>Ctrl + Shift + A (Cmd + Shift + A on the mac)</p></li>

<li><p>Type ‘Gradle’ into the action search bar</p></li>

<li><p>Select ‘Gradle’ from the list of actions</p></li>

<li><p>Once the gradle tasks window appears, double click uploadArchives from the ‘All Tasks’ list</p></li>

<li><p>Once this is done, you should be able to save this gradle task as a build configuration so that running it again is simpler:</p></li>
</ol>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-18-at-7-54-06-am.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-18-at-7-54-06-am.png?w=660" alt="Screen Shot 2015-01-18 at 7.54.06 AM" /></a></p>

<p>Another way to run the uploadArchives task is to use the gradle wrapper in your project. The command is simple:</p>

<p><code>/gradlew uploadArchives</code></p>

<p>If the task runs successfully, you should be able to return to the archiva interface, select “Browse” from the side menu, and see the artifact that you’ve just uploaded:</p>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-18-at-7-58-43-am.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-18-at-7-58-43-am.png?w=660" alt="Screen Shot 2015-01-18 at 7.58.43 AM" /></a> To configure your app projects to consume the maven artifacts that you publish to archiva, you need to make two changes to two different build.gradle files in your project. First, go to the top level gradle file and add your archiva instance as a maven repository. Adding archiva as a maven repo is simple:</p>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-16-at-11-19-39-pm.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-16-at-11-19-39-pm.png?w=660" alt="Screen Shot 2015-01-16 at 11.19.39 PM" /></a></p>

<p>Next, go to the build.gradle file for the particular module you are building. Here, you simply need to add the maven artifact as a dependency to your module:</p>

<p><a href="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-18-at-8-03-27-am.png"><img src="http://www.philosophicalhacker.com/wp-content/uploads/2015/01/screen-shot-2015-01-18-at-8-03-27-am.png?w=660" alt="Screen Shot 2015-01-18 at 8.03.27 AM" /></a></p>

<p>That’s it! Once you’ve configured all your library projects to publish artifacts to archiva, building projects that are dependent on multiple libraries is now really simple. It involves exactly one step:</p>

<ol>
<li>Checkout app project. Hit build.</li>
</ol>

                </article>
          </div>
        </section>                
  </div>
  
</div>
<footer class="page-footer green text-white">
    <div class="container">
      <div class="row">
        <div class="col l6 s12">
            
<link href="//cdn-images.mailchimp.com/embedcode/slim-10_7.css" rel="stylesheet" type="text/css">
<div id="mc_embed_signup">
<form action="//appspot.us11.list-manage.com/subscribe/post?u=9612e1a3261cb5689813bf38b&amp;id=0c5f737d6c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL">Get Email Updates</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="email address" required>
    
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_9612e1a3261cb5689813bf38b_0c5f737d6c" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>


            <div class="rc-scout" style="text-align: center;"></div>    
        </div>
        <aside id="meta">            
            <div>
                
                <div>                  
                  <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/2014/10/03/an-alternative-multiproject-setup-for-android-studio/">Previous: An Alternative Multiproject Setup for Android Studio</a>
                </div>
                
                
                <div>                  
                  <a class="grey-text text-lighten-3" href="https://www.philosophicalhacker.com/2015/01/24/why-ayn-rands-psychology-is-probably-wrong/">Next: Why Ayn Rand&#39;s Psychology is Probably Wrong (or trivial)</a>
                </div>
                
            </div>
        </aside>  
        <div class="col l4 offset-l2 s12">
          <h5 class="white-text">Tags</h5>
          <ul>              
                          
          </ul>
        </div>
      </div>
    </div>
    <div class="footer-copyright">
      <div class="container">
      © 2019 Matt Dupree
      </div>
    </div>    
  </footer>        


        </div><script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script>
  document.addEventListener("DOMContentLoaded", function() {
    var elems = document.querySelectorAll(".sidenav");
    var instances = M.Sidenav.init(elems, {});
  });
</script>
<script async defer src="https://www.recurse-scout.com/loader.js?t=b7a91d718a76fe21289fbe7d51a58f19"></script>

  
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-63544399-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
